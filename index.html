<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="build/react.js"></script>
    <script src="build/react-dom.js"></script>
    <script src="build/browser.min.js"></script>
    <script src="build/jquery.min.js"></script>
  </head>
  <body>
    <div id="container"></div>
    <script type="text/babel">


      var AudioTrack = React.createClass({

        getInitialState: function() {
          return {
            timeElapsed: '0:00',
            timeTotal: '0:00'
          }
        },

        handlePlayer: function() {
          this.props.onHandle();
        },

        componentDidMount: function() {
          this.setState({
            timeElapsed: this.handlePlayer().timeElapsed,
            timeTotal: this.handlePlayer().timeTotal
          });
        },

        render: function(){
          return (
            <div className='audio-track'>
              <b ref='AudioTrackMeta' className='track-meta'>The Arctic Suicides: Its Not The Dark That Kills You</b>
              <b ref='AudioTrackProgressBar' className="progress-bar"></b>
              <time ref='AudioTrackTimeElapsed' className="time-elapsed" onHandle={this.handlePlayer}>{this.state.timeElapsed}</time>
              <time ref='AudioTrackTimeTotal' className="time-total" onHandle={this.handlePlayer}>{this.state.timeTotal}</time>
            </div>
          );
        }

      });

      var AudioControls = React.createClass({

        getInitialState: function(){
          return {
            playing: false,
            playingClassName: 'playing'
          }
        },

        clickButton: function(){
          this.props.clickButton();
          this.setState({playing: !this.state.playing});
          !this.state.playing ? $(this.refs.button).addClass(this.state.playingClassName) : $(this.refs.button).removeClass(this.state.playingClassName)
          // $(this.refs.button).toggleClass('playing');
        },

        render: function(){
          return (
            <div>
              <button type='button' ref='button' className='player-play-pause-stop' onClick={this.clickButton}>Play/Pause</button>
            </div>
          );
        }

      });

      var AudioWrap = React.createClass({

        handlePlayer: function() {
          this.props.onHandle();
        },

        clickButton: function() {
          this.props.clickButton();
        },

        render: function(){
          return (
            <div className='audio-wrap'>
              <AudioControls clickButton={this.clickButton} />
              <AudioTrack onHandle={this.handlePlayer} />
            </div>
          )
        }
      });

      var Player = React.createClass({

        getInitialState: function() {
          return {
            playing: false
          }
        },

        timeElapsed: function() {
          return this.refs.audio.currentTime;
        },

        timeTotal: function() {
          return this.refs.audio.duration;
        },

        onPlay: function() {
          this.setState({playing: true});
          this.refs.audio.play();
        },

        onPause: function() {
          this.setState({playing: false});
          this.refs.audio.pause();
        },

        render: function(){
          return (
            <div className='player'>
              <audio controls preload='false' ref='audio'>
                <source src="http://pd.npr.org/anon.npr-mp3/npr/atc/2016/04/20160421_atc_the_arctic_suicides_its_not_the_dark_that_kills_you.mp3?orgId=1&topicId=1031&aggIds=475000154&d=495&p=2&story=474847921&t=progseg&e=475082290&seg=4&siteplayer=true" />
              </audio>
            </div>
          )
        }
      });

      var AudioBox = React.createClass({

        handlePlayer: function() {
          return {
            timeElapsed: this.refs.player.timeElapsed(),
            timeTotal: this.refs.player.timeTotal()
          }
        },

        clickButton: function() {
          !this.refs.player.state.playing ? this.refs.player.onPlay() : this.refs.player.onPause();
        },

        render: function(){
          return (
            <div className='audio-box'>
              <Player ref='player' />
              <AudioWrap ref='audiowrap' onHandle={this.handlePlayer} clickButton={this.clickButton} />
            </div>
          )
        }
      });

      ReactDOM.render(
        <AudioBox />,
        document.getElementById('container')
      );

    </script>
  </body>
</html>
